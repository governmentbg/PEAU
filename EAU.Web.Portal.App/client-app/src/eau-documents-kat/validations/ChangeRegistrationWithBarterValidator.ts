import { EAUBaseValidator, resourceManager } from "eau-core";
import { DocumentFormValidationContext } from "eau-documents";
import { VehicleRegistrationChangeWithBarterVM } from "../models/ModelsAutoGenerated";
import { VehicleRegistrationDataValidator } from "./VehicleRegistrationDataValidator";
import { VehicleOwnerDataVMValidator } from "./VehicleOwnerDataVMValidator";
import { action } from "mobx";

export class ChangeRegistrationWithBarterValidator extends EAUBaseValidator<VehicleRegistrationChangeWithBarterVM, DocumentFormValidationContext> {

    constructor() {
        super();

        this.ruleFor(m => m.firstVehicleData).setValidator(new VehicleRegistrationDataValidator());
        this.ruleFor(m => m.secondVehicleData).setValidator(new VehicleRegistrationDataValidator());

        this.ruleFor(m => m.firstVehicleOwners).setCollectionValidator(new VehicleOwnerDataVMValidator());
        this.ruleFor(m => m.secondVehicleOwners).setCollectionValidator(new VehicleOwnerDataVMValidator());
        
    }
    @action validate(obj: VehicleRegistrationChangeWithBarterVM): boolean {
        let result = super.validate(obj);

        if (obj.firstVehicleData && obj.secondVehicleData) {
            if (obj.firstVehicleData.registrationNumber == obj.secondVehicleData.registrationNumber) {
                //В полето за идентификационни данни за ППС има дублиран регистрационен номер на ППС
                obj.addError(resourceManager.getResourceByKey("DOC_GL_DUPLICATE_REGNUMBER_E"));
                result = false;
            }
        }        

        return result;
    }
}